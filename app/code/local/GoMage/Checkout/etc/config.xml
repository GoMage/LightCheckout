<?xml version="1.0" encoding="utf-8"?>
<!--
 /**
 * GoMage LightCheckout Extension
 *
 * @category     Extension
 * @copyright    Copyright (c) 2010-2012 GoMage (http://www.gomage.com)
 * @author       GoMage
 * @license      http://www.gomage.com/license-agreement/  Single domain license
 * @terms of use http://www.gomage.com/terms-of-use
 * @version      Release: 3.1
 */ 
 -->
<config>
    <modules>
        <GoMage_Checkout>
            <version>0.0.3.1</version>
        </GoMage_Checkout>
    </modules>
    <global>
    	<blocks>
	        <gomage_checkout><class>GoMage_Checkout_Block</class></gomage_checkout>
	        <adminhtml>
                <rewrite>
                	<sales_order_totals>GoMage_Checkout_Block_Adminhtml_Sales_Order_Totals</sales_order_totals>
                	<sales_order_invoice_totals>GoMage_Checkout_Block_Adminhtml_Sales_Order_Invoice_Totals</sales_order_invoice_totals>
          			<sales_order_creditmemo_totals>GoMage_Checkout_Block_Adminhtml_Sales_Order_Creditmemo_Totals</sales_order_creditmemo_totals>
	        	</rewrite>
	        </adminhtml>
	        <sales>
		        <rewrite>
	                <order_totals>GoMage_Checkout_Block_Sales_Order_Totals</order_totals>
	                <order_invoice_totals>GoMage_Checkout_Block_Sales_Order_Invoice_Totals</order_invoice_totals>
	                <order_creditmemo_totals>GoMage_Checkout_Block_Sales_Order_Creditmemo_Totals</order_creditmemo_totals>              		
	                <order_info>GoMage_Checkout_Block_Sales_Order_Info</order_info>
	                <order_print>GoMage_Checkout_Block_Sales_Order_Print</order_print>
		        </rewrite>
	        </sales>
	        <checkout>
	        	<rewrite>
	        		<onepage_success>GoMage_Checkout_Block_Checkout_Success</onepage_success>
	        	</rewrite>
	        </checkout>	        			
	    </blocks>
	    <models>
            <gomage_checkout><class>GoMage_Checkout_Model</class></gomage_checkout>
            <!--<checkout>
            	<rewrite>
            		<type_onepage>GoMage_Checkout_Model_Type_Onepage</type_onepage>
            	</rewrite>
            </checkout>
            -->
            <core>
            	<rewrite>
            		<url_rewrite>GoMage_Checkout_Model_Url_Rewrite</url_rewrite>
            	</rewrite>
            </core>
            <tax>
            	<rewrite>
            		<calculation>GoMage_Checkout_Model_Tax_Calculation</calculation>
            	</rewrite>
            </tax>
            <tax_mysql4>
            	<rewrite>
            		<calculation>GoMage_Checkout_Model_Mysql4_Tax_Calculation</calculation>
            	</rewrite>
            </tax_mysql4>
            <sales>
            	<rewrite>
            		<quote_address>GoMage_Checkout_Model_Quote_Address</quote_address>
            		<!--<quote>GoMage_Checkout_Model_Quote</quote>-->
            		<!--<quote_address_total_shipping>GoMage_Checkout_Model_Quote_Address_Total_Shipping</quote_address_total_shipping>-->
            	</rewrite>
            </sales>              
            <paypal>
            	<rewrite>
            		<api_nvp>GoMage_Checkout_Model_Paypal_Api_Nvp</api_nvp>
            	</rewrite>
            </paypal>            
        </models>
        <resources>
            <gomage_checkout_setup>
                <setup>
                    <module>GoMage_Checkout</module>
                    <class>Mage_Eav_Model_Entity_Setup</class>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </gomage_checkout_setup>   
            <gomage_checkout_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </gomage_checkout_write>
            <gomage_checkout_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </gomage_checkout_read>
		</resources>
    	<fieldsets>
    		<sales_convert_quote>
    			<gomage_checkout_customer_comment><to_order>gomage_checkout_customer_comment</to_order></gomage_checkout_customer_comment>
    		</sales_convert_quote>
    	</fieldsets>
    	<helpers>
			<gomage_checkout><class>GoMage_Checkout_Helper</class></gomage_checkout>
		</helpers>
		<rewrite>
			<gomage_checkout_onepage_cart>
                <from><![CDATA[#^/checkout/cart#]]></from>
                <to>/gomage_checkout/cart</to>
            </gomage_checkout_onepage_cart>
         	<!--
            <gomage_checkout_onepage_index_1>
                <from><![CDATA[#^/checkout/onepage/$#]]></from>
                <to>/gomage_checkout/onepage/index</to>
            </gomage_checkout_onepage_index_1>
            <gomage_checkout_onepage_index_2>
                <from><![CDATA[#^/checkout/onepage$#]]></from>
                <to>/gomage_checkout/onepage/index</to>
            </gomage_checkout_onepage_index_2>
            -->
        </rewrite>
        <sales>
        	<order_invoice>
        		<totals>
        			<gomage_gift_wrap>
                        <class>gomage_checkout/order_invoice_total_giftwrap</class>
                    </gomage_gift_wrap>
        		</totals>	
        	</order_invoice>
        	<order_creditmemo>
        		<totals>
        			<gomage_gift_wrap>
                        <class>gomage_checkout/order_creditmemo_total_giftwrap</class>
                    </gomage_gift_wrap>
        		</totals>	
        	</order_creditmemo>	
        	<quote>
                <totals>                    
                    <gomage_gift_wrap>
                        <class>gomage_checkout/quote_giftwrap</class>
                        <after>subtotal,shipping</after>
                        <before>grand_total</before>
                        <renderer>gomage_checkout/checkout_giftwrap</renderer>
                        <admin_renderer>gomage_checkout/adminhtml_sales_order_create_totals_giftwrap</admin_renderer>
                    </gomage_gift_wrap>
                </totals>                
            </quote>
        </sales>
        <pdf>
        	<totals>
        		<gomage_gift_wrap translate="title">
                    <title>Gift Wrapping</title>
                    <source_field>gomage_gift_wrap</source_field>                    
                    <font_size>7</font_size>
                    <display_zero>0</display_zero>
                    <sort_order>250</sort_order>
                </gomage_gift_wrap>
        	</totals>	
        </pdf>	
        <fieldsets>
        	<sales_convert_quote_address>
        		<gomage_gift_wrap_amount><to_order>*</to_order></gomage_gift_wrap_amount>
        		<base_gift_wrap_amount_amount><to_order>*</to_order></base_gift_wrap_amount_amount>
        		<!--
        		<gomage_gift_wrap_amount><to_order_item_gomage_gift_wrap>*</to_order_item_gomage_gift_wrap></gomage_gift_wrap_amount>
        		<base_gomage_gift_wrap_amount><to_order_item_gomage_gift_wrap>*</to_order_item_gomage_gift_wrap></base_gomage_gift_wrap_amount>
        		-->
        	</sales_convert_quote_address>	
        	<sales_convert_order>
        		<gomage_gift_wrap_amount><to_quote_address_shipping>*</to_quote_address_shipping></gomage_gift_wrap_amount>
        		<base_gomage_gift_wrap_amount><to_quote_address_shipping>*</to_quote_address_shipping></base_gomage_gift_wrap_amount>
        	</sales_convert_order>	
        	<sales_convert_order_item>
        		<gomage_gift_wrap><to_quote_item>*</to_quote_item></gomage_gift_wrap>
                <gomage_gift_wrap_amount><to_quote_item>*</to_quote_item></gomage_gift_wrap_amount>
                <base_gomage_gift_wrap_amount><to_quote_item>*</to_quote_item></base_gomage_gift_wrap_amount>
        	</sales_convert_order_item>	
        	<sales_convert_quote_item>
                <gomage_gift_wrap><to_order_item>*</to_order_item></gomage_gift_wrap>
                <gomage_gift_wrap_amount><to_order_item>*</to_order_item></gomage_gift_wrap_amount>
                <base_gomage_gift_wrap_amount><to_order_item>*</to_order_item></base_gomage_gift_wrap_amount>
        	</sales_convert_quote_item>     
        </fieldsets>		
	</global>
	<frontend>
		<secure_url>
            <gomage_checkout_onepage>/gomage_checkout/onepage</gomage_checkout_onepage>
        </secure_url>
		<routers>
			<gomage_checkout>
				<use>standard</use>
	            <args>
	               <module>GoMage_Checkout</module>
	               <frontName>gomage_checkout</frontName>
	            </args>
	        </gomage_checkout>
		</routers>
		<layout>
            <updates>
                <gomage_checkout module="gomage_checkout">
                    <file>gomage-checkout.xml</file>
                </gomage_checkout>
            </updates>
        </layout>
        <events>
        	<gomage_checkout_save_quote_before>
                <observers>
                    <giftmessage>
                        <type>model</type>
                        <class>giftmessage/observer</class>
                        <method>checkoutEventCreateGiftMessage</method>
                    </giftmessage>
                </observers>
            </gomage_checkout_save_quote_before>
            <sales_order_load_after>
                <observers>
                    <collect_totals_after>
                        <type>model</type>
                        <class>gomage_checkout/observer</class>
                        <method>salesOrderLoad</method>
                    </collect_totals_after>
                </observers>
            </sales_order_load_after>
            <controller_action_postdispatch_gomage_checkout_onepage_save>
                <observers>
                    <payflowlink_save_order_onepage>
                        <class>gomage_checkout/observer</class>
                        <method>setResponseAfterSaveOrder</method>
                    </payflowlink_save_order_onepage>
                </observers>
            </controller_action_postdispatch_gomage_checkout_onepage_save>
        </events>
        <translate>
			<modules>
				<GoMage_Checkout>
					<files>
						<default>Gomage_LightCheckout.csv</default>
					</files>
				</GoMage_Checkout>
			</modules>
        </translate>
	</frontend>
	<adminhtml>
		<events>
			<admin_system_config_changed_section_gomage_activation>
                <observers>
                    <collect_totals_after>
                        <type>model</type>
                        <class>gomage_checkout/observer</class>
                        <method>checkK</method>
                    </collect_totals_after>
                </observers>
            </admin_system_config_changed_section_gomage_activation>
        </events>
		<translate>
			<modules>
				<GoMage_Checkout>
					<files>
						<default>Gomage_LightCheckout.csv</default>
					</files>
				</GoMage_Checkout>
			</modules>
        </translate>
		<layout>
            <updates>
                <gomage_checkout module="gomage_checkout">
                    <file>gomage-checkout.xml</file>
                </gomage_checkout>
            </updates>
        </layout>
        <acl>
	        <resources>
	            <admin>
	                <children>
	                    <system>
	                        <children>
	                            <config>
	                                <children>
	                                    <gomage_checkout>
	                                    	<title>GoMage - Light Checkout</title>
	                                    </gomage_checkout>
	                                    <gomage_activation>
	                                    	<title>GoMage - Activation</title>
	                                    </gomage_activation>
	                                </children>
	                            </config>
	                        </children>
	                    </system>
	                </children>
	            </admin>
	        </resources>
	    </acl>
	</adminhtml>
	<default>
		<sales>
            <totals_sort>
                <gomage_gift_wrap>25</gomage_gift_wrap>                
            </totals_sort>            
        </sales>
        <tax>
        	<cart_display> 
        		<gomage_gift_wrap>1</gomage_gift_wrap> 
        	</cart_display>  
        	<sales_display>
        		<gomage_gift_wrap>1</gomage_gift_wrap>
        	</sales_display>	
        </tax> 
		<gomage_checkout>
			<registration>
				<mode>0</mode>
			</registration>
			<ajax>
				<country>1</country>
				<region>1</region>
				<postcode>1</postcode>
				<city>1</city>
			</ajax>
			<termsandconditions>
				<enabled>0</enabled>
				<width>500</width>
				<height>300</height>
			</termsandconditions>
			<general>
				<enabled>0</enabled>
				<geoip_enabled>0</geoip_enabled>
				<title>GoMage LightCheckout</title>
				<deliverydate>1</deliverydate>
				<skin>orange</skin>
				<button_skin>default</button_skin>
				<disable_mobile>1</disable_mobile>
			</general>
			<address_fields>
				
				<firstname>1</firstname>
				<lastname>1</lastname>
				
				<company>0</company>
				<company_order>1</company_order>
				
				<country_id>1</country_id>
				<country_id_order>2</country_id_order>
				
				<region>req</region>
				<region_order>3</region_order>
				<postcode>req</postcode>
				<postcode_order>3</postcode_order>
				
				<city>req</city>
				<city_order>4</city_order>
				
				<street>req</street>
				<street_order>5</street_order>
				
				<telephone>req</telephone>
				<telephone_order>6</telephone_order>
				<fax>opt</fax>
				<fax_order>6</fax_order>
				
				<comments>0</comments>
				<newsletter>0</newsletter>
			</address_fields>
			<address_sort>
				
				
				<company_order>1</company_order>
				<country_id_order>2</country_id_order>
				<region_order>3</region_order>
				<postcode_order>3</postcode_order>
				<city_order>4</city_order>
				<street_order>5</street_order>
				<telephone_order>6</telephone_order>
				<fax_order>6</fax_order>
				
			</address_sort>
			<vat>
				<vat_verification>0</vat_verification>
				<show_checkbox>3</show_checkbox>
				<text_under>Buy without VAT (for EU only)</text_under>
			</vat>
			<gift_wrapping>
				<title>Gift Wrapping</title>
			</gift_wrapping>	
			<helper><v>Y2xhc3MgR29NYWdlX0NoZWNrb3V0X0hlbHBlcl9EYXRhIGV4dGVuZHMgTWFnZV9Db3JlX0hlbHBlcl9BYnN0cmFjdHsgcHJvdGVjdGVkICRtb2RlOyBwcm90ZWN0ZWQgJGNvdW50cnlfaWQ7IHB1YmxpYyBmdW5jdGlvbiBnZXRDb25maWdEYXRhKCRub2RlKXsgcmV0dXJuIE1hZ2U6OmdldFN0b3JlQ29uZmlnKCJnb21hZ2VfY2hlY2tvdXQvIi4kbm9kZSk7IH0gcHVibGljIGZ1bmN0aW9uIGdldENoZWNrb3V0TW9kZSgpeyBpZihpc19udWxsKCR0aGlzLT5tb2RlKSl7IGlmKE1hZ2U6OmdldFNpbmdsZXRvbigiY2hlY2tvdXQvdHlwZV9vbmVwYWdlIiktPmdldFF1b3RlKCktPmlzQWxsb3dlZEd1ZXN0Q2hlY2tvdXQoKSl7ICR0aGlzLT5tb2RlID0gaW50dmFsKCR0aGlzLT5nZXRDb25maWdEYXRhKCJyZWdpc3RyYXRpb24vbW9kZSIpKTsgfWVsc2V7ICR0aGlzLT5tb2RlID0gMTsgfSB9IHJldHVybiAkdGhpcy0+bW9kZTsgfSBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsU3RvcmVEb21haW5zKCl7ICRkb21haW5zID0gYXJyYXkoKTsgZm9yZWFjaCAoTWFnZTo6YXBwKCktPmdldFdlYnNpdGVzKCkgYXMgJHdlYnNpdGUpIHsgJHVybCA9ICR3ZWJzaXRlLT5nZXRDb25maWcoIndlYi91bnNlY3VyZS9iYXNlX3VybCIpOyBpZigkZG9tYWluID0gdHJpbShwcmVnX3JlcGxhY2UoIi9eLio/XC9cLyguKik/XC8vIiwgIiQxIiwgJHVybCkpKXsgJGRvbWFpbnNbXSA9ICRkb21haW47IH0gJHVybCA9ICR3ZWJzaXRlLT5nZXRDb25maWcoIndlYi9zZWN1cmUvYmFzZV91cmwiKTsgaWYoJGRvbWFpbiA9IHRyaW0ocHJlZ19yZXBsYWNlKCIvXi4qP1wvXC8oLiopP1wvLyIsICIkMSIsICR1cmwpKSl7ICRkb21haW5zW10gPSAkZG9tYWluOyB9IH0gcmV0dXJuIGFycmF5X3VuaXF1ZSgkZG9tYWlucyk7IH0gcHVibGljIGZ1bmN0aW9uIGdldEF2YWlsYXZlbFdlYnNpdGVzKCl7IHJldHVybiAkdGhpcy0+X3coKTsgfSBwcm90ZWN0ZWQgZnVuY3Rpb24gX3coKXsgJHIgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygiZ29tYWdlX2FjdGl2YXRpb24vbGlnaHRjaGVja291dC9hciIpOyAkcyA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCJnb21hZ2VfYWN0aXZhdGlvbi9saWdodGNoZWNrb3V0L3dlYnNpdGVzIik7IHJldHVybiBleHBsb2RlKCIsIiwgc3RyX3JlcGxhY2UoJHIsICIiLCBNYWdlOjpoZWxwZXIoImNvcmUiKS0+ZGVjcnlwdCgkcykpKTsgfSBwdWJsaWMgZnVuY3Rpb24gYSgkayl7ICRjaCA9IGN1cmxfaW5pdCgpOyBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCBzcHJpbnRmKCJodHRwOi8vZ29tYWdlLndlYi9pbmRleC5waHAvZ29tYWdlX2Rvd25sb2FkYWJsZS9rZXkvY2hlY2sva2V5LyVzL2RvbWFpbnMvJXMiLCAkaywgaW1wbG9kZSgiLCIsICR0aGlzLT5nZXRBbGxTdG9yZURvbWFpbnMoKSkpKTsgY3VybF9zZXRvcHQgKCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7IGN1cmxfc2V0b3B0ICgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOyAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOyAkciA9IFplbmRfSnNvbjo6ZGVjb2RlKCRjb250ZW50KTsgJHZhbHVlMSA9ICIiOyAkdmFsdWUyID0gIiI7ICRlID0gTWFnZTo6aGVscGVyKCJjb3JlIik7IGlmKGlzc2V0KCRyWyJkIl0pICYmIGlzc2V0KCRyWyJjIl0pKXsgJHZhbHVlMSA9ICRlLT5lbmNyeXB0KGJhc2U2NF9lbmNvZGUoWmVuZF9Kc29uOjplbmNvZGUoJHIpKSk7IH0gJHMgPSBhcnJheV9zbGljZShleHBsb2RlKCIsIiwgTWFnZTo6Z2V0U3RvcmVDb25maWcoImdvbWFnZV9hY3RpdmF0aW9uL2xpZ2h0Y2hlY2tvdXQvd2Vic2l0ZXMiKSksIDAsICRyWyJjIl0pOyAkdmFsdWUyID0gJGUtPmVuY3J5cHQoJHZhbHVlMS5pbXBsb2RlKCIsIiwgJHMpLiR2YWx1ZTEpOyAkZ3JvdXBzID0gYXJyYXkoICJsaWdodGNoZWNrb3V0Ij0+YXJyYXkoICJmaWVsZHMiPT5hcnJheSggImFyIj0+YXJyYXkoICJ2YWx1ZSI9PiR2YWx1ZTEgKSwgIndlYnNpdGVzIj0+YXJyYXkoICJ2YWx1ZSI9PihzdHJpbmcpJHZhbHVlMiApICkgKSApOyBNYWdlOjpnZXRNb2RlbCgiYWRtaW5odG1sL2NvbmZpZ19kYXRhIikgLT5zZXRTZWN0aW9uKCJnb21hZ2VfYWN0aXZhdGlvbiIpIC0+c2V0R3JvdXBzKCRncm91cHMpIC0+c2F2ZSgpOyB9IHB1YmxpYyBmdW5jdGlvbiBnYSgpeyByZXR1cm4gWmVuZF9Kc29uOjpkZWNvZGUoYmFzZTY0X2RlY29kZShNYWdlOjpoZWxwZXIoImNvcmUiKS0+ZGVjcnlwdChNYWdlOjpnZXRTdG9yZUNvbmZpZygiZ29tYWdlX2FjdGl2YXRpb24vbGlnaHRjaGVja291dC9hciIpKSkpOyB9IHB1YmxpYyBmdW5jdGlvbiBnZXRHZW9pcFJlY29yZCgpeyByZXR1cm4gR2VvSVBfQ29yZTo6Z2V0SW5zdGFuY2UoTWFnZTo6Z2V0QmFzZURpcigibWVkaWEiKS4iL2dlb2lwL0dlb0xpdGVDaXR5LmRhdCIsIEdlb0lQX0NvcmU6OkdFT0lQX1NUQU5EQVJEKS0+Z2VvaXBfcmVjb3JkX2J5X2FkZHIoJF9TRVJWRVJbIlJFTU9URV9BRERSIl0pOyB9IHB1YmxpYyBmdW5jdGlvbiBnZXREZWZhdWx0Q291bnRyeUlkKCl7IGlmKGlzX251bGwoJHRoaXMtPmNvdW50cnlfaWQpKXsgaWYoTWFnZTo6Z2V0U3RvcmVDb25maWcoImdvbWFnZV9jaGVja291dC9nZW9pcC9nZW9pcF9lbmFibGVkIikgJiYgZmlsZV9leGlzdHMoTWFnZTo6Z2V0QmFzZURpcigibWVkaWEiKS4iL2dlb2lwL0dlb0xpdGVDaXR5LmRhdCIpICYmIGV4dGVuc2lvbl9sb2FkZWQoIm1ic3RyaW5nIikpeyB0cnl7ICR0aGlzLT5jb3VudHJ5X2lkID0gR2VvSVBfQ29yZTo6Z2V0SW5zdGFuY2UoTWFnZTo6Z2V0QmFzZURpcigibWVkaWEiKS4iL2dlb2lwL0dlb0xpdGVDaXR5LmRhdCIsIEdlb0lQX0NvcmU6OkdFT0lQX1NUQU5EQVJEKS0+Z2VvaXBfY291bnRyeV9jb2RlX2J5X2FkZHIoJF9TRVJWRVJbIlJFTU9URV9BRERSIl0pOyB9Y2F0Y2goRXhjZXB0aW9uICRlKXsgZWNobyAkZTsgfSB9IGlmICghJHRoaXMtPmNvdW50cnlfaWQpIHsgJHRoaXMtPmNvdW50cnlfaWQgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygiZ29tYWdlX2NoZWNrb3V0L2dlbmVyYWwvZGVmYXVsdF9jb3VudHJ5Iik7IGlmICghJHRoaXMtPmNvdW50cnlfaWQpIHsgJHRoaXMtPmNvdW50cnlfaWQgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygiZ2VuZXJhbC9jb3VudHJ5L2RlZmF1bHQiKTsgfSB9IH0gcmV0dXJuICR0aGlzLT5jb3VudHJ5X2lkOyB9IHB1YmxpYyBmdW5jdGlvbiBnZXREZWZhdWx0U2hpcHBpbmdNZXRob2QoKXsgJGFkZHJlc3MgPSBNYWdlOjpnZXRTaW5nbGV0b24oImNoZWNrb3V0L3Nlc3Npb24iKS0+Z2V0UXVvdGUoKS0+Z2V0U2hpcHBpbmdBZGRyZXNzKCk7ICRhZGRyZXNzLT5zZXRDb2xsZWN0U2hpcHBpbmdSYXRlcyh0cnVlKS0+Y29sbGVjdFNoaXBwaW5nUmF0ZXMoKTsgJHJhdGVzID0gJGFkZHJlc3MtPmdldEdyb3VwZWRBbGxTaGlwcGluZ1JhdGVzKCk7IGlmKGNvdW50KCRyYXRlcykgPT0gMSl7IGZvcmVhY2goJHJhdGVzIGFzICRyYXRlX2NvZGU9PiRtZXRob2RzKXsgaWYoY291bnQoJG1ldGhvZHMpID09IDEpeyBmb3JlYWNoKCRtZXRob2RzIGFzICRtZXRob2QpeyByZXR1cm4gJG1ldGhvZC0+Z2V0Q29kZSgpOyB9IH1lbHNleyByZXR1cm4gJHRoaXMtPmdldENvbmZpZ0RhdGEoImdlbmVyYWwvZGVmYXVsdF9zaGlwcGluZ19tZXRob2QiKTsgfSB9IH1lbHNleyByZXR1cm4gJHRoaXMtPmdldENvbmZpZ0RhdGEoImdlbmVyYWwvZGVmYXVsdF9zaGlwcGluZ19tZXRob2QiKTsgfSB9IHB1YmxpYyBmdW5jdGlvbiBnZXREZWZhdWx0UGF5bWVudE1ldGhvZCgpeyByZXR1cm4gJHRoaXMtPmdldENvbmZpZ0RhdGEoImdlbmVyYWwvZGVmYXVsdF9wYXltZW50X21ldGhvZCIpOyB9IHB1YmxpYyBmdW5jdGlvbiBnZXRBY3RpdmVQYXltZW50TWV0aG9kcygkc3RvcmU9bnVsbCkgeyAkbWV0aG9kcyA9IGFycmF5KCk7ICRjb25maWcgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygicGF5bWVudCIsICRzdG9yZSk7IGZvcmVhY2ggKCRjb25maWcgYXMgJGNvZGUgPT4gJG1ldGhvZENvbmZpZykgeyBpZihpc3NldCgkbWV0aG9kQ29uZmlnWyJtb2RlbCJdKSAmJiAkbWV0aG9kQ29uZmlnWyJtb2RlbCJdKXsgaWYoaXNzZXQoJG1ldGhvZENvbmZpZ1siZ3JvdXAiXSkgJiYgJG1ldGhvZENvbmZpZ1siZ3JvdXAiXSA9PSAibWJvb2tlcnMiICYmIE1hZ2U6OmdldFN0b3JlQ29uZmlnRmxhZygibW9uZXlib29rZXJzLyIuJGNvZGUuIi9hY3RpdmUiLCAkc3RvcmUpKXsgJG1ldGhvZCA9ICR0aGlzLT5fZ2V0UGF5bWVudE1ldGhvZCgkY29kZSwgJG1ldGhvZENvbmZpZyk7ICRtZXRob2RbImdyb3VwIl0gPSAibWJvb2tlcnMiOyAkbWV0aG9kc1skY29kZV0gPSAkbWV0aG9kOyB9ZWxzZWlmKCRtZXRob2RDb25maWdbIm1vZGVsIl0gPT0gImdvb2dsZWNoZWNrb3V0L3BheW1lbnQiKXsgaWYoTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCJnb29nbGUvY2hlY2tvdXQvYWN0aXZlIiwgJHN0b3JlKSl7ICRtZXRob2QgPSAkdGhpcy0+X2dldFBheW1lbnRNZXRob2QoJGNvZGUsICRtZXRob2RDb25maWcpOyAkbWV0aG9kc1skY29kZV0gPSAkbWV0aG9kOyB9IH1lbHNlaWYgKE1hZ2U6OmdldFN0b3JlQ29uZmlnRmxhZygicGF5bWVudC8iLiRjb2RlLiIvYWN0aXZlIiwgJHN0b3JlKSkgeyAkbWV0aG9kID0gJHRoaXMtPl9nZXRQYXltZW50TWV0aG9kKCRjb2RlLCAkbWV0aG9kQ29uZmlnKTsgJG1ldGhvZFsiZ3JvdXAiXSA9ICIiOyAkbWV0aG9kc1skY29kZV0gPSAkbWV0aG9kOyB9IH0gfSByZXR1cm4gJG1ldGhvZHM7IH0gcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRQYXltZW50TWV0aG9kKCRjb2RlLCAkY29uZmlnLCAkc3RvcmU9bnVsbCkgeyAkbW9kZWxOYW1lID0gJGNvbmZpZ1sibW9kZWwiXTsgJG1ldGhvZCA9IE1hZ2U6OmdldE1vZGVsKCRtb2RlbE5hbWUpOyAkbWV0aG9kLT5zZXRJZCgkY29kZSktPnNldFN0b3JlKCRzdG9yZSk7IHJldHVybiAkbWV0aG9kOyB9IHB1YmxpYyBmdW5jdGlvbiBnZXRWYXRCYXNlQ291bnRyeU1vZGUoKXsgcmV0dXJuICR0aGlzLT5nZXRDb25maWdEYXRhKCJ2YXQvYmFzZV9jb3VudHJ5Iik7IH0gcHVibGljIGZ1bmN0aW9uIGdldFZhdFdpdGhpbkNvdW50cnlNb2RlKCl7IHJldHVybiAkdGhpcy0+Z2V0Q29uZmlnRGF0YSgidmF0L2lmX25vdF9iYXNlX2NvdW50cnkiKTsgfSBwdWJsaWMgZnVuY3Rpb24gZ2V0VGF4Q291bnRyaWVzKCl7IGlmKCRydWxlX2lkID0gaW50dmFsKE1hZ2U6OmhlbHBlcigiZ29tYWdlX2NoZWNrb3V0IiktPmdldENvbmZpZ0RhdGEoInZhdC9ydWxlIikpKXsgJHJlc291cmNlID0gTWFnZTo6Z2V0U2luZ2xldG9uKCJjb3JlL3Jlc291cmNlIik7ICRjb25uZWN0aW9uID0gJHJlc291cmNlLT5nZXRDb25uZWN0aW9uKCJyZWFkIik7ICRxID0gc3ByaW50ZigiU0VMRUNUIERJU1RJTkNUKGB0YXhfY291bnRyeV9pZGApIEZST00gYCVzYCBXSEVSRSBgdGF4X2NhbGN1bGF0aW9uX3JhdGVfaWRgIElOIChTRUxFQ1QgYHRheF9jYWxjdWxhdGlvbl9yYXRlX2lkYCBGUk9NIGAlc2AgV0hFUkUgYHRheF9jYWxjdWxhdGlvbl9ydWxlX2lkYCA9ICVkKSIsICRyZXNvdXJjZS0+Z2V0VGFibGVOYW1lKCJ0YXhfY2FsY3VsYXRpb25fcmF0ZSIpLCAkcmVzb3VyY2UtPmdldFRhYmxlTmFtZSgidGF4X2NhbGN1bGF0aW9uIiksICRydWxlX2lkKTsgcmV0dXJuIChhcnJheSkkY29ubmVjdGlvbi0+ZmV0Y2hDb2woJHEpOyB9IH0gfQ==</v></helper>
		</gomage_checkout>
	</default>
</config>